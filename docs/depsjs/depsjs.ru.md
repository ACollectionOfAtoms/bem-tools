# Технология для описания зависимостей

* [Введение](#Введение)
* [Используемые обозначения](#Используемые-обозначения)
* [Синтаксис DEPS](#Синтаксис-deps)
* [Примеры](#Примеры)

## Введение

Для указания зависимостей от иных блоков, элементов, модификаторов и технологий используются файлы-технологии `deps.js`.

Зависимости описываются для всех [БЭМ-сущностей](https://ru.bem.info/methodology/key-concepts/#БЭМ-сущность), если они разнесены на файловой системе и не отражены в [декларации](https://ru.bem.info/methodology/declarations/).

В качестве примера рассмотрим [форму поиска](https://ru.bem.info/methodology/build/#Описание-зависимостей), построенную на основе блоков `input` (поле ввода) и `button` (кнопка).

*Шаблон `search-form.bemhtml.js`*

```js
block('search-form')(
    content()({
        block: 'input'
    },{
        block: 'button'
    })
);
```

Чтобы подключить на проект стили и скрипты блоков `input` и `button`, понадобится создать файл `search-form.deps.js`:

```js
/* search-form ---> input; search-form ---> button */
({
    shouldDeps: [
        { block: 'input' },
        { block: 'button' }
    ]
})
```

В процессе сборки все технологии реализации блоков `input` и `button` будут автоматически собраны в финальные наборы файлов (бандлы).

**Пример**

![Сборка БЭМ-проекта](https://rawgit.com/bem-archive/bem-tools/godfreyd-deps/docs/depsjs/build__decl__search-form.svg)

## Используемые обозначения

Для короткой записи зависимостей в комментариях используются следующие условные обозначения:

* `/* b1 ---> b2 */` — блок `b1` зависит от блока `b2`;
* `/* b1 ---> b1__e1 */` — блок `b1` зависит от своего элемента `b1__e1`;
* `/* b1 ---> b1__e1_m1_v1 */` — блок `b1` зависит от своего модификатора `b1__e1_m1_v1`;
* `/* b1.js ---> b2.bemhtml */` — блок `b1` в технологии реализации JavaScript зависит от блока `b2` в технологии реализации BEMHTML.

## Синтаксис DEPS

**DEPS-сущность** — сущность, определяющая зависимость между БЭМ-сущностями.

Формат представления DEPS-сущности в файле `deps.js` имеет следующий синтаксис:

```js
({
    /* DEPS-сущность */
})
```

Полная запись DEPS-сущности имеет следующий вид:

```js
/* DEPS-сущность */
({
    block : 'block-name',
    elem  : 'elem-name',
    mod   : 'modName',
    val   : 'modValue',
    tech  : 'techName',
    shouldDeps : [ /* БЭМ-сущность */ ],
    mustDeps   : [ /* БЭМ-сущность */ ],
    noDeps     : [ /* БЭМ-сущность */ ],
    include    : false
})
```

**Примечание** Все поля являются опциональными.

Поля DEPS-сущности:

* Поля описывающие БЭМ-сущность, для которой определяется зависимость:
  * `block` (строка) — имя блока;
  * `elem` (строка) — имя элемента;
  * `mod` (строка) — имя модификатора;
  * `val` (строка) — значение модификатора.
* Поле описывающее технологию реализации БЭМ-сущности:
  * `tech` (строка) — технология, для которой собираются зависимости (например, JS).
* Поля определяющие зависимость:
  * `shouldDeps` (массив/объект) — определяет зависимости, порядок подключения которых не важен;
  * `mustDeps` (массив/объект) — определяет зависимости, которые гарантировано попадут в результаты сборки до кода БЭМ-сущности, в которой эти зависимости объявлены;
  * `noDeps` (массив/объект) — отменяет зависимости от более низких [уровней переопределения](https://ru.bem.info/methodology/key-concepts/#Уровень-переопределения) до того уровня, на котором объявлен `noDeps`.

### Поля описывающие БЭМ-сущность, для которой определяется зависимость

Поля `block`, `elem`, `mod`, `val` указывают, для какой БЭМ-сущности необходимо подключить зависимость. Они могут быть восстановлены из контекста по имени файла. Поэтому следующие записи для файла `b1__e1_m1_v1.deps.js` эквивалентны:

```js
/* b1__e1_m1_v1 ---> b2 */
({
    block: 'b1',
    elem: 'e1',
    mod: 'm1',
    val: 'v1',
    shouldDeps : { block : 'b2' }
})
```

```js
/* b1__e1_m1_v1 ---> b2 */
({
    shouldDeps: { block: 'b2' }
})
```

### Поле описывающее технологию реализации БЭМ-сущности

Поле `tech` указывает, для какой технологии необходимо подключить зависимость. Подключение зависимостей по технологии (`depsByTech`) используется, например, для того, чтобы собрать в клиентский JavaScript-бандл шаблоны только тех блоков, которые будут использованы в браузере. При такой схеме часть шаблонизации происходит на стороне сервера и, следовательно, некоторые шаблоны на клиенте никогда не используются.

**Пример**

*Файл `search-form.deps.js`*

```js
/* search-form ---> button.bemhtml;  search-form ---> input.bemhtml */
({
    shouldDeps: [
        { block: 'button', tech: 'bemhtml' },
        { block: 'input', tech: 'bemhtml' }
    ]
})
```

В процессе сборки в финальные наборы файлов попадет только указанная технология реализации.

![Сборка по технологии ](https://rawgit.com/bem-archive/bem-tools/godfreyd-deps/docs/depsjs/build__decl__search-form__tech.svg)

### Поля определяющие зависимость

Поля `mustDeps`, `shouldDeps` определяют зависимость, а `noDeps` отменяет существующую зависимость, объявленную на более низких уровнях переопределения.

**Сравнение shouldDeps и mustDeps**

Иногда требуется [изменить реализацию блока](https://ru.bem.info/methodology/key-concepts/#Переопределение-блока) путем добавления ему новых особенностей на другом уровне. В этом случае будет не достаточно просто подключить БЭМ-сущность в сборку. Поле `mustDeps` позволяет определить зависимости, которые гарантировано попадут в результаты сборки до кода БЭМ-сущности, в которой эти зависимости объявлены.

![shouldDeps & mustDeps](https://rawgit.com/bem-archive/bem-tools/godfreyd-deps/docs/depsjs/shouldDeps&mustDeps.svg#s)

> Подробнее о [синтаксисе DEPS и базовых типах данных](specification.ru.md).

## Примеры

### Подключение блока

Файл `b1.deps.js`:

```js
/* b1 ---> b2 */
({
    shouldDeps : { block : 'b2' }
})
```

### Подключение элемента

Файл `b1.deps.js`:

```js
/* b1 ---> b1__e1 */
({
    shouldDeps : { block : 'b1', elem : 'e1' }
})
```

**Примечание** Поле `elem` подключает только элемент, но не сам блок.

### Подключение модификатора

#### Модификатор вида «ключ-значение»

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1_v1 */
({
    shouldDeps : { block : 'b1', mod: 'm1', val: 'v1' }
})
```

#### Булевый модификатор

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1 */
({
    shouldDeps : { block : 'b1', mod: 'm1' }
})
```

*ИЛИ*

Файл `b1.deps.js`:

```js
/* b1 ---> b1_m1 */
({
    shouldDeps : { block : 'b1', mod: 'm1', val: true  }
})
```

### Подключение зависимостей по технологии

Файл `b1.deps.js`:

```js
/* b1.js ---> b1_m1_v1.bemhtml */
({
    tech: 'js',
    mustDeps: [
        {
            block: 'b1',
            mod: 'm1',
            val: 'v1',
            tech: 'bemhtml'
        }
    ]
})
```
