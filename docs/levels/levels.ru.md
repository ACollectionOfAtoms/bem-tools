# Уровни переодпределения

Самый удобный способ настройки уровней переопределения - секция `levels` файла `make.js`. Секция позволяет задать настройки уровня как
для отдельных уровней проекта, так и для группы уровней используя маску. Пример `make.js`:

```javascript
module.exports = function(make) {
    make.levels(function(levels) {
        levels.addLevel('*.bundles')
            .addTechs('js', 'css', 'bemhtml')
    });
};
```

Вызов `levels.addLevel(mask, [opts])` создает новый объект конструктора уровня. В качестве первого аргумента функция принимает путь к папке уровня
или маску. Последующие вызовы (до следующего `addLevel` или до конца секции) предназначены для настройки этого уровня:

* `addTechs(tech1, tech2, ...)` - добавляет список модулей технологий на уровень;
* `setNamingScheme(schemeName)` -  задает схему именования файлов БЭМ-сущностей на уровне;
* `addTypes(type1, type2, ...)` - добавляет типы к уровню. Тип - это строка, которая в дальнейшем может использоваться для идентификации
опрделенных классов уровней;
* `setDefaultTechs` - задает имена технологий, используемых в команде `bem create` по умолчанию для этого уровня;
* `setBundleBuildLevels` - для уровня бандлов задает уровни, содержащие исходный код блоков;

В процессе сборки для каждого уровня переопределения будет использоваться первая конфигурация, маска которой соответствует директории уровня.

## Задание списка технологий на уровне

При вызове метода `addTechs` конструктора, модуль технологии можно задать одним из следующих способов:

1. Именем модуля. Поиск путей к конкретному файлу будет выполнен автоматически;
2. Объектом вида `{"имя модуля": "/путь/к/модулю"}` - загружает объект технологию из заданного файла;
3. Объектом вида `{"имя модуля": миксин}` - задает модуль технологии прямо в настройках уровня;

### Поиск путей к модулям технологии

Если технология задана просто именем, поиск модуля для загрузки будет производится в следующем порядке:

1. npm-пакеты, заданные при помощи вызовов `useNpmModule` конструктора;
2. папка `.bem/techs` в корне проекта;
3. технологии, поставляемые вместе с bem-tools:

    * bemdecl.js
    * blocks
    * bundles
    * css
    * deps.js
    * dir
    * docs
    * examples
    * ie.css
    * ie6.css
    * ie7.css
    * ie8.css
    * ie9.css
    * js
    * js-i
    * level-proto
    * level
    * min
    * min.css
    * min.js
    * project
    * tech-docs

При загрузке модуля технологии из npm-пакета порядок обхода модулей совпадает с порядком вызовов `useNpmModule(moduleName)`.
Вызов `useNpmModule` до вызова `addTech` добавит пакет ко всем уровням проекта, после - только к текущему конфигурируемому уровню.

## Задание схемы именования

По умолчанию используется следующая схема отображения БЭМ-сущностей в файловую систему (на примере технологии `css`):

```
level/
    block/
        __elem/
            _mod/
                block__elem_mod_val.css
            block__elem.css
        _mod/
            block_mod_val.css
        block.css
```

Поменять эту схему можно при помощи вызова `setNamingScheme(schemeName | mixin)` конструктора уровней.

Вместе с bem-tools также поставляется схема именования `simple`, которая выглядит так:

```
level/
    block1.css
    block1__elem.css
    block1__elem_mod.css
    block2.css
```

Также есть возможность создать собственную схему именования, передав в `setNamingScheme` миксин с реализацией методов `get-*` и
`match-*`. В качестве примера реализации можно использовать [код схемы simple](https://github.com/bem/bem-tools/blob/release-1.0.0/lib/level/naming/simple.js).

## Расширение уровней

Уровень можно создать на основе любого ранее определённого уровня. Для этого во втором параметре `addLevel` необходимо указать опцию `extends`,
в которую передается маска ранее заданного уровня. Например:

```javascript
module.exports = function(make) {
    make.levels(function(levels) {
        levels
            .addLevel('*.blocks')
                .setNamingScheme('simple')
                .addTechs('js', 'css')
            .addLevel('*.bundles', {extends: '*.blocks'})
                .addTech('html');
    });
};
```

В этом случае уровень `*.bundles` наследует все параметры уровня `*.blocks`, а также добавляет на уровень бандлов технологию `html`.

## .bem/level.js

Для задания настроек уровня переопределения также можно использовать файл `.bem/level.js`. Этот файл должен находится в директории уровня
и его содержимое имеет больший приоритет, чем настройки в `make.js`. Файл должен экспортировать функцию, которая вернет класс, описывающий данный
уровень. Для создание конструктора класса используется вызов `BEM.defineLevel`.
Определение уровня заканчивается вызовом `createClass()` конструктора. Пример:

```javascript
module.exports = function(BEM) {
    return BEM.defineLevel()
        .addTechs('js', 'css')
        .createClass();
}
```

Методы для настройки параметров уровня в `level.js` аналогичны методам, используемым в секции `levels`.

Для расширения уровней, заданных в файлах `.bem/level.js` можно воспользоваться статическим методом `extend` базового уровня:

```javascript
module.exports = function(BEM) {
    var BaseLevel = require('/path/to/base/level')(BEM);
    return BaseLevel.extend()
        .addTechs('html')
        .createClass();
}
```

